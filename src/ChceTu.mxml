<?xml version="1.0" encoding="utf-8"?>
<s:ViewNavigatorApplication contentBackgroundAlpha="0" addedToStage="_added()" xmlns:fx="http://ns.adobe.com/mxml/2009"
                            xmlns:s="library://ns.adobe.com/flex/spark" firstView="pl.needapp.chcetu.view.HomeView"
                            creationComplete="_cc()" xmlns:ui="pl.needapp.chcetu.view.ui.*"
                            xmlns:mx="library://ns.adobe.com/flex/mx" stateChangeComplete="stch()">
    <s:states>
        <s:State name="normal"/>
        <s:State name="menu"/>
    </s:states>

    <s:navigationContent>
        <s:ToggleButton label="MENU" click="{setCurrentState(currentState == 'normal' ? 'menu' : 'normal')}"/>
        <mx:Spacer width="20"/>
        <s:Label text="A tu wypasione logo" color="white"/>
        <ui:LeftMenu id="menu11" width="300" height="700" includeInLayout="false" y="50" includeIn="menu"/>
    </s:navigationContent>

    <s:actionContent>

    </s:actionContent>


    <fx:Script><![CDATA[
        import caurina.transitions.Tweener;
        import caurina.transitions.properties.ColorShortcuts;

        import mx.core.FlexGlobals;
        import mx.core.UIComponent;

        import pl.needapp.chcetu.view.ZglaszamView;

        import spark.components.ViewNavigator;

        public static var view:StageWebView;
        public static var NAVIGATOR:ViewNavigator;
        public static var ROOT:ChceTu;

        private function _cc():void {
            ColorShortcuts.init();

            NAVIGATOR = navigator;
            ROOT = this;
        }

        private function _added():void {


        }

        public function hideMenu():void {
            setCurrentState("normal");
        }

        public static function showHTML(url:String, s:String = null):void {
            //TODO Do komunikacji https://code.google.com/p/stagewebviewbridge/

            view = new StageWebView();
            view.stage = (FlexGlobals.topLevelApplication as UIComponent).stage;
            view.viewPort = new Rectangle(0, 50, view.stage.stageWidth, view.stage.stageHeight - 50);
            if (url) {
                view.loadURL(url);
            }
            else {
                view.loadString(s);
            }
            view.addEventListener( LocationChangeEvent.LOCATION_CHANGING,
                    handleLocationChanging );

        }

        private static function handleLocationChanging(event:LocationChangeEvent):void {
            event.preventDefault();

            //location parameter will have a absolute path of the .html file as a prefix
            var strParameters:Array = (event.location as String).split("$");
            NAVIGATOR.pushView(ZglaszamView, {label: "Przydałaby się ścieżka rowerowa"});
            trace(strParameters[1] + "Is the string received from Javascript");
        }

        public static function hideHTML():void {
            view.stage = null;
            view.viewPort = null;
            view.dispose();
            view = null;
        }

        private function stch():void {
            if (currentState == "menu") {
                menu11.x = -menu11.width;
                Tweener.addTween(menu11, {x: 0, time: 1});
            }
        }
        ]]></fx:Script>
</s:ViewNavigatorApplication>
